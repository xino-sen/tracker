<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RideTracker - Live Map</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="map-page">

    <div class="map-search-container">
        <div class="search-bar">
            <i data-feather="search"></i>
            <input type="text" placeholder="Search destination...">
        </div>
    </div>

    <div id="map" class="full-map">
    </div>

    <div class="vehicle-sheet">
        <div class="handle"></div>
        <div class="sheet-header">
            <div>
                <h2>Tesla Model 3</h2>
                <p>Status: <span class="moving">Moving • 45 km/h</span></p>
            </div>
            <div class="battery-indicator">
                <i data-feather="zap"></i> 88%
            </div>
        </div>
        
        <div class="quick-actions">
            <button class="action-btn"><i data-feather="lock"></i> Lock</button>
            <button class="action-btn" id="alarmBtn"><i data-feather="bell"></i>Alarm</button>
            <button class="action-btn primary"><i data-feather="play"></i> Remote Start</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i data-feather="home"></i></a>
        <a href="map.html" class="nav-item active"><i data-feather="map"></i></a>
        <a href="activity.html" class="nav-item"><i data-feather="activity"></i></a>
        <a href="settings.html" class="nav-item"><i data-feather="settings"></i></a>
    </nav>
    <script>
        feather.replace();

        // 1. Initialize the map (centered on a sample coordinate)
        const map = L.map('map', {
            zoomControl: false // Hide default zoom buttons for a cleaner mobile look
        }).setView([51.505, -0.09], 13);

        // 2. Add a Professional Dark Map Layer (CartoDB Dark Matter)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // 3. Create a Custom Car Marker
        const carIcon = L.divIcon({
            className: 'custom-div-icon',
            html: "<div style='background-color:#38bdf8; width:15px; height:15px; border-radius:50%; border:3px solid white; box-shadow: 0 0 15px #38bdf8;'></div>",
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        const marker = L.marker([51.505, -0.09], { icon: carIcon }).addTo(map);

        // 4. Simulate Movement (Optional: make the car move slightly)
        setInterval(() => {
            let lat = marker.getLatLng().lat + 0.0001;
            let lng = marker.getLatLng().lng + 0.0001;
            marker.setLatLng([lat, lng]);
            // map.panTo([lat, lng]); // Uncomment to follow the car
        }, 2000);
        // Add this inside your script
        document.querySelector('.map-btn:last-child').onclick = () => {
            const currentLatLng = marker.getLatLng();
            map.flyTo(currentLatLng, 16, { animate: true, duration: 1.5 });
        };
        // Vibration Logic for the Alarm
        const alarmBtn = document.getElementById('alarmBtn');

        alarmBtn.onclick = () => {
            // Check if the browser/device supports vibration
            if ("vibrate" in navigator) {
                // Pattern: Vibrate 500ms, Pause 200ms, Vibrate 500ms (Repeats)
                // This mimics a real siren/alarm feel
                navigator.vibrate([500, 200, 500, 200, 800]);
                
                // Visual feedback
                alarmBtn.style.color = "#ff4d4d";
                alarmBtn.style.boxShadow = "0 0 15px rgba(255, 77, 77, 0.5)";
                
                setTimeout(() => {
                    alarmBtn.style.color = "";
                    alarmBtn.style.boxShadow = "";
                }, 3000);
            } else {
                alert("Vibration not supported on this device. Alarm triggered!");
            }
        };
        alarmBtn.onclick = () => {
            if ("vibrate" in navigator) {
                // Trigger the physical vibration
                navigator.vibrate([300, 100, 300, 100, 300]);
                
                // Add the visual ringing class
                alarmBtn.classList.add('ringing');
                
                // Stop after 2 seconds
                setTimeout(() => {
                    alarmBtn.classList.remove('ringing');
                }, 2000);
            }
        };
    </script>
    <script>feather.replace();</script>
</body>
</html>